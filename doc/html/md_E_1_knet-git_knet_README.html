<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>knet: knet 1.4.x</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">knet
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
   <div id="projectbrief">cross platform, light-weight, multithreading net library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li class="current"><a href="pages.html"><span>相关页面</span></a></li>
      <li><a href="namespaces.html"><span>命名空间</span></a></li>
      <li><a href="annotated.html"><span>结构体</span></a></li>
      <li><a href="files.html"><span>文件</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">knet 1.4.x </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2></h2>
<p><b>knet</b> is cross-platform multi-threading light-weight TCP transport library, for now, knet support <b>IOCP</b>, <b>select</b>, <b>epoll</b> model on <b>Windows</b> and <b>CentOS</b>. it will testing under more Linux and Unix OS version, more model will be implemented like: kqueue(kevent) etc. <b>knet</b> is not a event loop like <b>libevent</b>, <b>knet</b> focus on transport only.</p>
<h3>loop</h3>
<h2></h2>
<p><code>loop_t</code> is the wrapper of different implemented model, it's easy to use <code>loop_t</code> to build a loop. </p><pre class="fragment">#include "knet.h"
loop_t* loop = loop_create();
</pre><p>For now, a loop is ready for run, we create a <code>channel_ref_t</code> as acceptor. </p><pre class="fragment">channel_ref_t* channel = loop_create_channel(loop, 0, 1024);
channel_ref_accept(channel, "127.0.0.1", 80);
</pre><p>We built a acceptor channel with infinite send chain size and maximal read buffer size 1024, after that run endless loop. </p><pre class="fragment">loop_run(loop);
loop_destroy(loop);
</pre><p>The program just holds your screen, we should add some code for new client coming. </p><pre class="fragment">void acceptor_cb(channel_ref_t* channel, channel_cb_event_e e) {
    if (e &amp; channel_cb_event_accept) {
        /* TODO do job here */
    }
}
</pre><p>The whole story: </p><pre class="fragment">#include "knet.h"

void acceptor_cb(channel_ref_t* channel, channel_cb_event_e e) {
    if (e &amp; channel_cb_event_accept) { /* the new client coming */
        /* TODO do job here */
    }
}

int main() {
    loop_t* loop = loop_create();
    channel_ref_t* channel = loop_create_channel(loop, 0, 1024);
    channel_ref_accept(channel, "127.0.0.1", 80);
    channel_ref_set_cb(channel, acceptor_cb);
    loop_run(loop);
    loop_destroy(loop);
    return 0;
}
</pre><p>For more detail, see <code><a class="el" href="basic_8c.html">examples/basic.c</a></code></p>
<h4><a class="el" href="config_8h.html">config.h</a></h4>
<h2></h2>
<pre class="fragment">#if defined(WIN32)
    #define LOOP_IOCP 1    /* IOCP */
    #define LOOP_SELECT 0  /* select */
#else
    #define LOOP_EPOLL 1   /* epoll */
    #define LOOP_SELECT 0  /* select */
#endif /* defined(WIN32) */
</pre><p>In header file <code><a class="el" href="config_8h.html">knet/config.h</a></code>, change the macro value to tell compiler choose specific implement, IOCP on Windows, epoll on Linux by default, more implement will be appended in the future release. </p><pre class="fragment">#define LOGGER_ON 0 /* the switch of internal logger */
#define LOGGER_MODE (logger_mode_file | logger_mode_console | logger_mode_flush | logger_mode_override) /* the mode of logger */
#define LOGGER_LEVEL logger_level_verbose /* the level of logger */
</pre><p><code>LOGGER_ON</code> is the switch of <b>knet</b> internal logger, the macro <code>LOGGER_MODE</code> and <code>LOGGER_LEVEL</code> can change the mode and the level of logger. Internal logger may help developer find the problom ASAP, <code>LOGGER_ON</code> should be set to 0 in release version.</p>
<h3>balancer</h3>
<h2></h2>
<p><code>loop_t</code> runs at the thread which calling <code>loop_run</code> or <code>loop_run_once</code>, each <code>loop_t</code> knows nothing about others. <code>loop_balancer_t</code> coordinates all attached <code>loop_t</code>(<code>loop_balance_attach</code>) and try to balance load for them.</p>
<p><code>loop_balancer_t</code> conceal the details and sophisticated for developer, the process of balancing is thread-safety and highly efficent. <b>knet</b> offers a simple thread API to run internally <code>loop_run</code>, the interact among loops are also transparent for developers.</p>
<p>For more detail, see <code><a class="el" href="multi__loop_8c.html">examples/multi_loop.c</a></code></p>
<h3>rpc</h3>
<h2></h2>
<p><b>knet</b> offers a low level <b>RPC</b> object framework for developer. <code>krpc_t</code> is the base for the next version(1.5.x), developers may develop handwriting code by <code>krpc_t</code>, but its not a good way to maintain code for future development.</p>
<p>For more detail, see <code><a class="el" href="examples_2rpc_8c.html">examples/rpc.c</a></code></p>
<h3>rpc code generating</h3>
<h2></h2>
<p><b>krpc</b> is a command line tool to generate RPC code for developes. The generated code utilizes RPC object framework to marshal/unmarshal the RPC method parameters, and a simple singleton RPC entry class.</p>
<p><code>krpc -d output-directory -f input_rpc_file -n rpc_class_name -l the_language_to_generate</code></p>
<p>After run the command, you'll find two files in the output-directory, <code>rpc_class_name.h</code> and <code>rpc_class_name.cpp</code>. For now, <code>krpc</code> supports C++ only.</p>
<p>For more detail, see</p>
<ul>
<li><code>krpc/examples/rpc_sample.rpc</code></li>
<li><code>krpc/examples/rpc_sample_object.rpc</code></li>
<li><code><a class="el" href="rpc_8cpp.html">krpc/examples/rpc.cpp</a></code></li>
<li><code><a class="el" href="rpc__sample_8h.html">krpc/examples/rpc_sample.h</a></code></li>
<li><code><a class="el" href="rpc__sample_8cpp.html">krpc/examples/rpc_sample.cpp</a></code></li>
</ul>
<h3>build</h3>
<h2></h2>
<ol type="1">
<li>Windows see <code>knet/win-proj/knet-vs2010.sln</code></li>
<li>Linux see <code>knet/CMakeLists.txt</code> <code>cmake CMakeLists.txt</code> <code>make</code></li>
</ol>
<p>The build result in folder <code>knet/bin</code>.</p>
<h3>test</h3>
<p>see <code>knet/bin</code>.</p>
<ol type="1">
<li>Windows <code>test_client-vs2010.exe</code> <code>test_server-vs2010.exe</code></li>
<li>Linux <code>test_client</code> <code>test_server</code></li>
<li>The command line of client<ol type="a">
<li><code>-ip</code> server listening IP</li>
<li><code>-port</code> server listening port</li>
<li><code>-n</code> connector count</li>
</ol>
</li>
<li>the command line of server<ol type="a">
<li><code>-ip</code> server listening IP</li>
<li><code>-port</code> server listening port</li>
<li><code>-w</code> worker count </li>
</ol>
</li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
生成于 2015年 六月 29日 星期一 16:51:00 , 为 knet使用  &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
